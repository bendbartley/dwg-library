<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>DWG Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:system-ui;background:#0b0d10;color:#e7edf3}
header{padding:14px;border-bottom:1px solid #243040}
main{display:grid;grid-template-columns:320px 1fr;height:calc(100vh - 58px)}
aside{border-right:1px solid #243040;padding:12px;overflow:auto}
section{padding:12px}
.item{padding:8px;border-bottom:1px solid #243040;cursor:pointer}
.item:hover{background:#1a2028}
.item.active{background:#243040}
.preview{height:100%;display:flex;align-items:center;justify-content:center;background:#fff}
.preview img{max-width:100%;max-height:100%}
</style>
</head>
<body>

<header>
  <strong>DWG Library</strong>
</header>

<main>
  <aside id="list"></aside>
  <section>
    <div id="title"></div>
    <div class="preview" id="preview">Select an item</div>
    <p><a id="download" target="_blank"></a></p>
  </section>
</main>

<script>
const LIBRARY_URL =
  "https://bendbartley.github.io/dwg-library/library.json";

let items = [];
let active = null;

async function loadLibrary(){
  const res = await fetch(LIBRARY_URL, { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to load library.json");
  const data = await res.json();
  if (!Array.isArray(data)) throw new Error("library.json must be an array");
  items = data;
  renderList();
}

function renderList(){
  const el = document.getElementById("list");
  el.innerHTML = "";
  items.forEach(it => {
    const d = document.createElement("div");
    d.className = "item";
    d.textContent = it.name;
    d.onclick = () => selectItem(it);
    el.appendChild(d);
  });
}

function selectItem(it){
  active = it;
  document.getElementById("title").textContent = it.name;

  const p = document.getElementById("preview");
  p.innerHTML = "";
  const img = document.createElement("img");
  img.src = it.pngUrl;
  p.appendChild(img);

  const a = document.getElementById("download");
  a.href = it.dwgUrl;
  a.textContent = "Download DWG";
}

loadLibrary().catch(err => {
  document.body.innerHTML = "<pre>" + err.message + "</pre>";
});
</script>

</body>
</html>
