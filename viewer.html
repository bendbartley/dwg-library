<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DWG Library Viewer (Portable)</title>
  <style>
    :root{
      --bg:#0b0d10; --panel:#12161c; --panel2:#0f1318;
      --text:#e7edf3; --muted:#9aa7b4; --accent:#6ee7ff; --bad:#ff6e6e;
      --border:#243040;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg,#080a0d,#0b0d10 30%,#07090b);
      color:var(--text);
    }
    header{
      padding:16px 18px;
      border-bottom:1px solid var(--border);
      background:rgba(18,22,28,.9);
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(6px);
    }
    header .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    h1{font-size:16px;margin:0;font-weight:650;letter-spacing:.2px}
    .sub{color:var(--muted); font-size:12px}

    .wrap{display:grid; grid-template-columns: 380px 1fr; min-height: calc(100vh - 66px);}
    .left{
      border-right:1px solid var(--border);
      background:rgba(18,22,28,.65);
    }
    .right{background:rgba(10,12,15,.4);}
    .pane{padding:14px;}
    .card{
      background:linear-gradient(180deg, rgba(18,22,28,.9), rgba(15,19,24,.9));
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
    }
    .stack{display:flex; flex-direction:column; gap:10px;}
    input, button{
      font:inherit;
      color:var(--text);
      background:rgba(10,12,15,.9);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 10px;
      outline:none;
    }
    input:focus, button:focus{border-color: rgba(110,231,255,.55); box-shadow: 0 0 0 3px rgba(110,231,255,.12);}
    button{
      cursor:pointer;
      background:linear-gradient(180deg, rgba(110,231,255,.16), rgba(110,231,255,.06));
      user-select:none;
    }
    button.secondary{
      background:linear-gradient(180deg, rgba(154,167,180,.14), rgba(154,167,180,.06));
    }
    .btnrow{display:flex; gap:8px; flex-wrap:wrap;}
    .small{font-size:12px; color:var(--muted); line-height:1.4;}

    .results{
      margin-top:10px;
      border:1px solid var(--border);
      border-radius:12px;
      overflow:hidden;
    }
    .result{
      padding:10px 10px;
      border-bottom:1px solid rgba(36,48,64,.7);
      background:rgba(10,12,15,.55);
      cursor:pointer;
    }
    .result:hover{background:rgba(110,231,255,.06);}
    .result.active{background:rgba(110,231,255,.10); outline:1px solid rgba(110,231,255,.25);}
    .result:last-child{border-bottom:none;}
    .rtitle{font-size:13px; font-weight:650;}
    .rmeta{font-size:12px; color:var(--muted); margin-top:2px; display:flex; gap:10px; flex-wrap:wrap;}

    .kwwrap{display:flex; gap:6px; flex-wrap:wrap; margin-top:8px;}
    .kw{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(110,231,255,.22);
      background:rgba(110,231,255,.08);
      font-size:12px;
      user-select:none;
    }

    .viewer{min-height: calc(100vh - 66px); padding:14px;}
    .viewer .card{height:100%;}
    .viewerHeader{display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .fileTitle{font-size:14px; font-weight:700;}
    .notice{padding:10px; border-radius:10px; border:1px solid rgba(255,110,110,.35); background:rgba(255,110,110,.06); color:var(--text); font-size:12px; line-height:1.4;}
    .ok{border-color: rgba(110,231,255,.35); background: rgba(110,231,255,.06);}

    .previewBox{
      border:1px solid rgba(36,48,64,.85);
      border-radius:12px;
      background:#ffffff;
      overflow:hidden;
      margin-top:10px;
    }

    /* Image viewer */
    .viewerControls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }
    .viewerControls .mini{padding:8px 10px; font-size:12px;}
    .previewViewport{
      width:100%;
      height: calc(100vh - 280px);
      min-height:420px;
      overflow:hidden;
      position:relative;
      touch-action:none;
      user-select:none;
      cursor:grab;
    }
    .previewViewport.dragging{cursor:grabbing;}
    .previewStage{
      position:absolute;
      left:0; top:0;
      transform-origin: 0 0;
      will-change: transform;
    }
    .previewImage{
      display:block;
      pointer-events:none;
    }

    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr;}
      .left{border-right:none; border-bottom:1px solid var(--border);}
      .previewViewport{height:60vh;}
    }
  </style>
</head>
<body>
<header>
  <div class="row">
    <div>
      <h1>DWG Library</h1>
      <div class="sub">Portable viewer. Loads library.json by URL. Previews PNG. Downloads DWG. Requests via email.</div>
    </div>
    <div class="btnrow">
      <button id="reloadBtn" class="secondary" title="Reload library.json">Reload</button>
      <button id="requestNewBtn" class="secondary" title="Email a request to add a new item">Request new item</button>
    </div>
  </div>
</header>

<div class="wrap">
  <aside class="left">
    <div class="pane">
      <div class="card stack">

        <div class="stack" style="gap:8px;">
          <div class="small" id="statusLine">Loading…</div>

          <div class="small" style="margin-top:4px;">Library URL</div>
          <input id="libraryUrlBox" placeholder="Paste library.json URL" />
          <div class="btnrow">
            <button id="setLibraryUrlBtn" class="secondary">Use URL</button>
          </div>

          <div class="small" id="libHint" style="display:none;"></div>
        </div>

        <div class="stack" style="margin-top:6px;">
          <input id="searchBox" placeholder="Search name, id, keywords…" />
          <div class="btnrow">
            <button id="resetBtn" class="secondary">Reset</button>
          </div>
        </div>

        <div class="results" id="results"></div>
        <div class="small" id="countLine"></div>
      </div>
    </div>
  </aside>

  <main class="right viewer">
    <div class="card">
      <div class="viewerHeader">
        <div>
          <div class="fileTitle" id="title">No item selected</div>
          <div class="small" id="meta"></div>
        </div>
        <div class="btnrow">
          <button id="downloadDwgBtn" style="display:none;">Download DWG</button>
          <button id="requestEditBtn" class="secondary" style="display:none;">Request edit</button>
        </div>
      </div>

      <div class="previewBox">
        <div id="previewHost" class="previewViewport" style="display:flex;align-items:center;justify-content:center;color:#667;padding:18px;">
          Select an item to preview its PNG.
        </div>
      </div>

      <div class="viewerControls">
        <button id="zoomOutBtn" class="secondary mini">−</button>
        <button id="zoomInBtn" class="secondary mini">+</button>
        <button id="centerBtn" class="secondary mini">Center</button>
        <button id="resetViewBtn" class="secondary mini">Reset</button>
        <button id="rotLeftBtn" class="secondary mini">⟲ 90°</button>
        <button id="rotRightBtn" class="secondary mini">⟳ 90°</button>
      </div>

      <div class="stack" style="margin-top:10px;">
        <div>
          <div class="small"><b>Keywords</b></div>
          <div class="kwwrap" id="kwWrap"></div>
        </div>

        <div id="warn" class="notice" style="display:none;"></div>
        <div id="info" class="notice ok" style="display:none;"></div>
      </div>

      <div class="small" style="margin-top:10px;">
        Tip: scroll-wheel / trackpad zoom, drag to pan, rotate buttons. Mailto won’t attach files reliably, because email clients hate you.
      </div>
    </div>
  </main>
</div>

<script>
(() => {
  // ===================== CONFIG =====================
  // Default URL used if user hasn't set one yet.
  // Replace this with your GitHub Pages URL:
  //   https://<user>.github.io/<repo>/library.json
  const DEFAULT_LIBRARY_URL = "https://bendbartley.github.io/dwg-library/library.json";

  const LIBRARY_URL_KEY = "dwg_library_url";

  // Where requests should go
  const REQUEST_EMAIL_TO = "ben@lalli.com.au";
  const REQUEST_EMAIL_CC = ""; // optional
  // ==================================================

  function getLibraryUrl(){
    return localStorage.getItem(LIBRARY_URL_KEY) || DEFAULT_LIBRARY_URL;
  }
  function setLibraryUrl(url){
    localStorage.setItem(LIBRARY_URL_KEY, url);
  }

  // UI
  const resultsEl = document.getElementById("results");
  const statusLine = document.getElementById("statusLine");
  const countLine = document.getElementById("countLine");
  const searchBox = document.getElementById("searchBox");
  const resetBtn = document.getElementById("resetBtn");
  const reloadBtn = document.getElementById("reloadBtn");

  const libraryUrlBox = document.getElementById("libraryUrlBox");
  const setLibraryUrlBtn = document.getElementById("setLibraryUrlBtn");
  const libHint = document.getElementById("libHint");

  const titleEl = document.getElementById("title");
  const metaEl = document.getElementById("meta");
  const previewHost = document.getElementById("previewHost");
  const kwWrap = document.getElementById("kwWrap");

  const warnEl = document.getElementById("warn");
  const infoEl = document.getElementById("info");

  const downloadDwgBtn = document.getElementById("downloadDwgBtn");
  const requestEditBtn = document.getElementById("requestEditBtn");
  const requestNewBtn = document.getElementById("requestNewBtn");

  // Viewer controls
  const zoomInBtn = document.getElementById("zoomInBtn");
  const zoomOutBtn = document.getElementById("zoomOutBtn");
  const resetViewBtn = document.getElementById("resetViewBtn");
  const centerBtn = document.getElementById("centerBtn");
  const rotLeftBtn = document.getElementById("rotLeftBtn");
  const rotRightBtn = document.getElementById("rotRightBtn");

  // State
  let items = [];
  let filtered = [];
  let activeId = null;

  // ====== Image viewer state ======
  let view = {
    scale: 1,
    minScale: 0.05,
    maxScale: 20,
    tx: 0,
    ty: 0,
    rot: 0,
    imgW: 0,
    imgH: 0
  };

  let viewportEl = null;
  let stageEl = null;
  let currentImgEl = null;

  let drag = { active:false, startX:0, startY:0, startTx:0, startTy:0 };

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function norm(s){ return (s ?? "").toString().trim().toLowerCase(); }

  function showWarn(msg){ warnEl.style.display="block"; warnEl.textContent=msg; }
  function hideWarn(){ warnEl.style.display="none"; }
  function showInfo(msg){ infoEl.style.display="block"; infoEl.textContent=msg; }
  function hideInfo(){ infoEl.style.display="none"; }

  function escapeHtml(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function clearPreview(text){
    previewHost.innerHTML = "";
    previewHost.style.display = "flex";
    previewHost.style.alignItems = "center";
    previewHost.style.justifyContent = "center";
    previewHost.style.color = "#667";
    previewHost.textContent = text || "";
    viewportEl = null; stageEl = null; currentImgEl = null;
  }

  function setPreviewElement(el){
    previewHost.innerHTML = "";
    previewHost.style.display = "block";
    previewHost.style.color = "inherit";
    previewHost.appendChild(el);
  }

  function applyTransform(){
    if (!stageEl) return;
    stageEl.style.transform = `translate(${view.tx}px, ${view.ty}px) rotate(${view.rot}deg) scale(${view.scale})`;
  }

  function fitToViewport(){
    if (!viewportEl || !currentImgEl) return;
    const vw = viewportEl.clientWidth;
    const vh = viewportEl.clientHeight;

    const iw = view.imgW || currentImgEl.naturalWidth || 1;
    const ih = view.imgH || currentImgEl.naturalHeight || 1;

    const s = Math.min(vw / iw, vh / ih) * 0.98;
    view.scale = clamp(s, view.minScale, view.maxScale);

    view.tx = (vw - iw * view.scale) / 2;
    view.ty = (vh - ih * view.scale) / 2;

    applyTransform();
  }

  function centerOnly(){
    if (!viewportEl || !currentImgEl) return;

    const vw = viewportEl.clientWidth;
    const vh = viewportEl.clientHeight;

    const iw = view.imgW || currentImgEl.naturalWidth || 1;
    const ih = view.imgH || currentImgEl.naturalHeight || 1;

    view.tx = (vw - iw * view.scale) / 2;
    view.ty = (vh - ih * view.scale) / 2;
    applyTransform();
  }

  function zoomAt(clientX, clientY, factor){
    if (!viewportEl) return;
    const rect = viewportEl.getBoundingClientRect();
    const px = clientX - rect.left;
    const py = clientY - rect.top;

    const oldScale = view.scale;
    const newScale = clamp(oldScale * factor, view.minScale, view.maxScale);
    if (newScale === oldScale) return;

    view.tx = px - (px - view.tx) * (newScale / oldScale);
    view.ty = py - (py - view.ty) * (newScale / oldScale);
    view.scale = newScale;

    applyTransform();
  }

  function setRotation(deg){
    view.rot = ((deg % 360) + 360) % 360;
    if (view.rot > 180) view.rot -= 360;
    applyTransform();
  }

  function resetView(){
    view.rot = 0;
    fitToViewport();
  }

  function wireViewerInteractions(viewport){
    viewport.onpointerdown = (e) => {
      if (e.pointerType === "mouse" && e.button !== 0) return;
      viewport.setPointerCapture(e.pointerId);
      drag.active = true;
      drag.startX = e.clientX;
      drag.startY = e.clientY;
      drag.startTx = view.tx;
      drag.startTy = view.ty;
      viewport.classList.add("dragging");
    };

    viewport.onpointermove = (e) => {
      if (!drag.active) return;
      const dx = e.clientX - drag.startX;
      const dy = e.clientY - drag.startY;
      view.tx = drag.startTx + dx;
      view.ty = drag.startTy + dy;
      applyTransform();
    };

    viewport.onpointerup = (e) => {
      drag.active = false;
      viewport.classList.remove("dragging");
      try{ viewport.releasePointerCapture(e.pointerId); } catch {}
    };

    viewport.onpointercancel = () => {
      drag.active = false;
      viewport.classList.remove("dragging");
    };

    viewport.addEventListener("wheel", (e) => {
      e.preventDefault();
      const factor = e.deltaY > 0 ? 0.90 : 1.10;
      zoomAt(e.clientX, e.clientY, factor);
    }, { passive:false });

    const ro = new ResizeObserver(() => { applyTransform(); });
    ro.observe(viewport);
  }

  function previewPngUrl(url, name){
    try{
      const viewport = document.createElement("div");
      viewport.className = "previewViewport";
      viewportEl = viewport;

      const stage = document.createElement("div");
      stage.className = "previewStage";
      stageEl = stage;

      const img = document.createElement("img");
      img.className = "previewImage";
      img.src = url;
      img.alt = name || "PNG preview";
      currentImgEl = img;

      img.onload = () => {
        view.imgW = img.naturalWidth;
        view.imgH = img.naturalHeight;
        showInfo(`Previewing: ${name || "PNG"}`);
        resetView();
      };
      img.onerror = () => {
        clearPreview("Could not render PNG preview.");
        showWarn("PNG failed to load. URL may be wrong or blocked.");
      };

      stage.appendChild(img);
      viewport.appendChild(stage);
      setPreviewElement(viewport);
      wireViewerInteractions(viewport);
    } catch (e){
      clearPreview("Could not render PNG preview.");
      showWarn(e?.message || String(e));
    }
  }

  // ===================== Data loading =====================
  async function loadLibrary(){
    hideWarn(); hideInfo();

    const libUrl = getLibraryUrl();
    statusLine.textContent = `Loading library.json… (${libUrl})`;

    try{
      const res = await fetch(libUrl, { cache: "no-store" });
      if (!res.ok) throw new Error(`Failed to load library.json (HTTP ${res.status})`);

      const data = await res.json();
      if (!Array.isArray(data)) throw new Error("library.json must be an array.");

      items = data
        .map(x => ({
          id: (x.id ?? "").toString().trim(),
          name: (x.name ?? "").toString().trim(),
          keywords: Array.isArray(x.keywords) ? x.keywords.map(norm).filter(Boolean) : [],
          png: (x.png ?? "").toString().trim(),
          dwg: (x.dwg ?? "").toString().trim(),
          updatedUtc: (x.updatedUtc ?? "").toString().trim()
        }))
        .filter(x => x.id && x.png && x.dwg);

      statusLine.textContent = `Loaded ${items.length} items`;
      applyFilter();

      if (items.length){
        const pick = items.find(x => x.id === activeId) || items[0];
        await selectItem(pick.id);
      } else {
        activeId = null;
        titleEl.textContent = "No item selected";
        metaEl.textContent = "";
        downloadDwgBtn.style.display = "none";
        requestEditBtn.style.display = "none";
        kwWrap.innerHTML = "";
        clearPreview("No items found in library.json.");
      }

      libHint.style.display = "block";
      libHint.textContent = "Tip: this URL is saved on this device (localStorage).";
    } catch (e){
      statusLine.textContent = "Load failed";
      showWarn(e?.message || String(e));

      items = [];
      filtered = [];
      resultsEl.innerHTML = "";
      countLine.textContent = "";
      clearPreview("Could not load library.json.");

      libHint.style.display = "block";
      libHint.textContent = "If this HTML is opened as file:/// and fetch is blocked, serve it via a local web server.";
    }
  }

  function applyFilter(){
    const q = norm(searchBox.value);
    const tokens = q.split(/\s+/).filter(Boolean);

    if (!tokens.length){
      filtered = [...items].sort((a,b)=> (a.name||"").localeCompare(b.name||""));
    } else {
      filtered = items
        .map(it => {
          const hay = (it.id + " " + it.name + " " + (it.keywords||[]).join(" ")).toLowerCase();
          let score = 0;
          for (const t of tokens){
            if ((it.keywords||[]).some(k => k.includes(t))) score += 3;
            if (hay.includes(t)) score += 1;
          }
          return { it, score };
        })
        .filter(x => x.score > 0)
        .sort((a,b)=> b.score - a.score || (a.it.name||"").localeCompare(b.it.name||""))
        .map(x => x.it);
    }

    renderResults();
    countLine.textContent = `${filtered.length} / ${items.length} items shown`;
  }

  function renderResults(){
    resultsEl.innerHTML = "";
    if (!filtered.length){
      const d = document.createElement("div");
      d.className = "result";
      d.style.cursor = "default";
      d.innerHTML = `<div class="rtitle">No matches</div><div class="rmeta">Try fewer keywords.</div>`;
      resultsEl.appendChild(d);
      return;
    }

    for (const it of filtered){
      const row = document.createElement("div");
      row.className = "result" + (it.id === activeId ? " active" : "");
      row.addEventListener("click", () => selectItem(it.id));

      const kwPrev = (it.keywords || []).slice(0, 6).join(", ");
      row.innerHTML = `
        <div class="rtitle">${escapeHtml(it.name || it.id)}</div>
        <div class="rmeta">
          <span>${escapeHtml(it.id)}</span>
          <span>•</span>
          <span>${(it.keywords||[]).length} keywords</span>
          <span>•</span>
          <span>${escapeHtml(kwPrev || "none")}${(it.keywords||[]).length>6 ? "…" : ""}</span>
        </div>
      `;
      resultsEl.appendChild(row);
    }
  }

  function renderKeywords(it){
    kwWrap.innerHTML = "";
    const kws = it.keywords || [];
    if (!kws.length){
      const s = document.createElement("div");
      s.className = "small";
      s.textContent = "No keywords.";
      kwWrap.appendChild(s);
      return;
    }
    for (const k of kws){
      const chip = document.createElement("div");
      chip.className = "kw";
      chip.textContent = k;
      kwWrap.appendChild(chip);
    }
  }

  async function selectItem(itemId){
    hideWarn(); hideInfo();
    activeId = itemId;
    renderResults();

    const it = items.find(x => x.id === itemId);
    if (!it){
      showWarn("Item not found.");
      return;
    }

    titleEl.textContent = it.name || it.id;
    metaEl.textContent =
      `ID: ${it.id} | Updated: ${it.updatedUtc ? new Date(it.updatedUtc).toLocaleString() : "unknown"}`;

    downloadDwgBtn.style.display = "inline-block";
    requestEditBtn.style.display = "inline-block";

    downloadDwgBtn.onclick = () => {
      const a = document.createElement("a");
      a.href = it.dwg;
      a.download = (it.id || "drawing") + ".dwg";
      document.body.appendChild(a);
      a.click();
      a.remove();
    };

    requestEditBtn.onclick = () => openRequestEmail("edit", it);

    renderKeywords(it);
    previewPngUrl(it.png, it.id + ".png");
  }

  // ===================== Mailto requests =====================
  function encodeMailto(s){ return encodeURIComponent(s).replace(/%20/g, "+"); }

  function openRequestEmail(kind, it){
    if (!REQUEST_EMAIL_TO || REQUEST_EMAIL_TO.includes("YOUR_EMAIL_HERE")){
      showWarn("Set REQUEST_EMAIL_TO in the viewer HTML first.");
      return;
    }

    const subject =
      kind === "new"
        ? "DWG Library request: new item"
        : `DWG Library request: edit (${it?.id || "unknown"})`;

    const lines = [];
    lines.push(`Request type: ${kind}`);
    lines.push(`Submitted: ${new Date().toISOString()}`);
    lines.push("");

    if (kind === "edit" && it){
      lines.push("Existing item:");
      lines.push(`- id: ${it.id}`);
      lines.push(`- name: ${it.name}`);
      lines.push(`- keywords: ${(it.keywords||[]).join(", ")}`);
      lines.push(`- png: ${it.png}`);
      lines.push(`- dwg: ${it.dwg}`);
      lines.push("");
      lines.push("Requested changes (fill in):");
      lines.push("- What should change?");
      lines.push("- New/updated keywords:");
      lines.push("- Replacement PNG/DWG:");
      lines.push("  - Attach files to this email OR paste links (R2/Dropbox/etc).");
    } else {
      lines.push("New item details (fill in):");
      lines.push("- Proposed id:");
      lines.push("- Name:");
      lines.push("- Keywords:");
      lines.push("- PNG: attach file OR link");
      lines.push("- DWG: attach file OR link");
    }

    lines.push("");
    lines.push("Note: mailto cannot reliably auto-attach files across email clients.");
    lines.push("If you want files included, attach them manually or provide a link.");

    const body = lines.join("\n");
    const params = [];
    params.push(`subject=${encodeMailto(subject)}`);
    params.push(`body=${encodeMailto(body)}`);
    if (REQUEST_EMAIL_CC) params.push(`cc=${encodeMailto(REQUEST_EMAIL_CC)}`);

    window.location.href = `mailto:${encodeURIComponent(REQUEST_EMAIL_TO)}?${params.join("&")}`;
  }

  // ===================== Wire controls =====================
  reloadBtn.addEventListener("click", loadLibrary);
  searchBox.addEventListener("input", applyFilter);
  resetBtn.addEventListener("click", () => { searchBox.value=""; applyFilter(); });

  setLibraryUrlBtn.addEventListener("click", () => {
    hideWarn();
    const u = (libraryUrlBox.value || "").trim();
    if (!u){
      showWarn("Paste a library.json URL.");
      return;
    }
    try{ new URL(u); }
    catch { showWarn("That is not a valid URL."); return; }

    setLibraryUrl(u);
    loadLibrary();
  });

  requestNewBtn.addEventListener("click", () => openRequestEmail("new", null));

  zoomInBtn.addEventListener("click", () => {
    if (!viewportEl) return;
    const rect = viewportEl.getBoundingClientRect();
    zoomAt(rect.left + rect.width/2, rect.top + rect.height/2, 1.25);
  });
  zoomOutBtn.addEventListener("click", () => {
    if (!viewportEl) return;
    const rect = viewportEl.getBoundingClientRect();
    zoomAt(rect.left + rect.width/2, rect.top + rect.height/2, 0.8);
  });
  resetViewBtn.addEventListener("click", resetView);
  centerBtn.addEventListener("click", centerOnly);
  rotLeftBtn.addEventListener("click", () => setRotation(view.rot - 90));
  rotRightBtn.addEventListener("click", () => setRotation(view.rot + 90));

  // Boot
  libraryUrlBox.value = getLibraryUrl();
  clearPreview("Loading…");
  loadLibrary();
})();
</script>
</body>
</html>
